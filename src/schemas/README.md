# Schemas

## JSON schemas

The JSON schemas are used as an intermediate representation of the CARPET-DSL. The JSON schemas can be generated by installing [typescript-json-schema](https://github.com/YousefED/typescript-json-schema) globally `npm install typescript-json-schema -g` and then executing `typescript-json-schema src/stores/taskGraphStore.ts "SerialisedTask" --ignoreErrors  --noExtraProps --required --out src/schemas/JSONSchemas/SerialisedTaskSchema.schema.json`. The JSON schemas are then used to 1. generate the zod schemas for runtime validation of the provided task schemas in the CARPET-DSL and 2. to generate documentation for the CARPET-DSL.

### VSCode JSON schema validation

VSCode allows for multiple ways to validate JSON files against a schema. This repository includes workspace settings that should already enable JSON schema validation for the CARPET-DSL JSON schemas. If the validation does not work, the following steps can be taken to enable JSON schema validation in VSCode: [VSCode Documentation](https://vscode-docs.readthedocs.io/en/latest/languages/json/#:~:text=The%20association%20of%20a%20JSON,Settings%29%20under%20the%20property%20json.)

### JSON schema documentation

The documentation is handled by the [json-schema-static-docs](https://github.com/tomcollins/json-schema-static-docs) package.

## zod schemas

The zod schemas are used for runtime validation of provided serialised task schemas in the CARPET-DSL in a JSON-format. The schemas can be generated by installing [json-schema-to-zod](https://github.com/StefanTerdell/json-schema-to-zod) globally `npm i -g json-schema-to-zod` and executing `json-schema-to-zod -i src/schemas/JSONSchemas/SerialisedTaskSchema.schema.json -o src/schemas/zodSchemas/SerialisedTaskSchema.ts`. The generated zod schemas are then used in the `src/stores/applicationStore.ts` to validate the provided task schemas.

[!CAUTION]
The zod schemas are generated by the `json-schema-to-zod` tool. The tool is not perfect and might generate valid but incorrect zod schemas. Therefore, the generated zod schemas should be checked manually and adjusted if necessary. A common error is that properties are marked as `.optional()` when they are not explicitly referenced in `required []`.

### Potential alternatives

[AJV](https://ajv.js.org/)
[joi](https://github.com/hapijs/joi)
[yup](https://github.com/jquense/yup)
[zod](https://zod.dev/)
